var data = {
  "meta": {
    "name": "AIR: Standard Edition (2005)",
    "author": "Winter Confetti",
    "language": "en-gb"
  },
  "Original Japanese": [
    {
      "name": "Dream / Common (Bad End)",
      "id": "dream-common",
      "route": [
        {
          "date": "18th July",
          "choices": [
            "別の手を考える",
            "走り出す",
            "話してみる",
            "走り出す",
            "さらに少女に移す",
            [
              {
                "choice": "試しにかけてみる",
                "comment": "For the lulzy option"
              },
              {
                "choice": "大人しくしておく",
                "comment": "For the plot option"
              }
            ],
			[
              {
                "choice": "もう一度ラーメン屋に電話する",
                "comment": "If you picked the first choice above"
              },
              {
                "choice": "友達に電話をかけてみる",
                "comment": "If you picked the second choice above"
              }
			],
            "反抗してみせる",
            "正直に答える",
            "飲める",
            "お願いします"
          ]
        },
        {
          "date": "19th July",
          "choices": [
            "リトライ",
            "学校の中に入る",
            "なんでもない振りをする",
            "食卓",
            "まともに答える",
            "手伝う",
            "「激プリチーだな」",
            "見せない",
            "聞く",
            "お仕置きってなんだ",
            [
              {
                "choice": "訊いてみる",
                "comment": "Non-H scene"
              },
              {
                "choice": "眠いので寝る",
                "comment": "H Scene / This H Scene is not present if you are using All ages patch"
              }
            ]
          ]
        },
        {
          "date": "20th July",
          "choices": [
            "なわとび",
            "地図の右へ",
            "とりあえず、声をかけてみる",
            "何でもいいから恩を売っておく",
            "バンダナのことを訊いてみる",
            "教えてほしいぞ",
            "おごらない",
            "実践してみる",
            "武田商店",
            "人形芸を見せてやる",
            "たぶんそうなるだろう",
            "考えておく",
            "紹介してもらう"
          ]
        },
        {
          "date": "21st July",
          "choices": [
            "買い取ったら観鈴にやる",
            "力自慢なところを見せつける",
            {
              "save": "A"
            },
            "遠慮する",
            "バイクに乗る",
            "断じて違う"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "友達と遊べ",
            "反撃する",
            "豪快に投げ飛ばす",
            "ヒマを持て余している",
            "人形芸を見せてやる",
            "学校へ",
            "嫌いじゃない",
            "散歩に出かける",
            "先に進んでみる",
            "様子を見る",
            "どうにか説明する"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "敢えてステゴザウルスＴシャツを借りる",
            "濡れたＴシャツに着替える",
            "商店街",
            "診療所の中",
            "意味もなく間を埋める",
            {
              "save": "B"
            },
            "堤防のほうへ歩いてゆく",
            "バス停へ",
            "町を出ることにする",
            {
              "end": "BAD END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Minagi",
      "id": "dream-minagi",
      "route": [
        {
          "choices": [
            {
              "load": "B"
            },
            "駅のほうへ歩いていく",
            "拾って、返してやる",
            "やっちゃう"
          ]
        },
        {
          "date": "24th July",
          "choices": [
            "骨を味わってみる",
            {
              "save": "C"
            },
            "やめておく"
          ]
        },
        {
          "date": "25th July",
          "choices": [
            "手を貸す",
            "人形を渡す",
            "暑いからやめようと懇願する",
            "上がってこいと言う",
            "バンダナにはもう触れない"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "観鈴を迎えに行く"
          ]
        },
        {
          "date": "27th July",
          "choices": [
            "素直に受け取る"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "タ行",
            "それでも辞書",
            "嫉妬してみる"
          ]
        },
        {
          "date": "7th August",
          "choices": [
            {
              "save": "D"
            },
			{
            "choice":"おはようのキスをしてくれ",
			"comment": "H Scene / This H Scene is not present if you are using All ages patch"
			},
            {
              "end": "NORMAL END"
            },
            {
              "load": "D"
            },
            "明日まで我慢してくれ",
            {
              "end": "MINAGI GOOD END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Kano",
      "id": "dream-kano",
      "route": [
        {
          "choices": [
            {
              "load": "C"
            },
            "食べていく"
          ]
        },
        {
          "date": "25th July",
          "choices": [
            "放っておく",
            "こうなったらとことんつき合う",
            "もう少しからかう",
            "バンダナにはもう触れない"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "金を稼ぎに商店街へ",
            "自力で探す",
            "人形劇の練習"
          ]
        },
        {
          "date": "28th July",
          "choices": [
            "承諾する"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "一緒に探してやると言う"
          ]
        },
        {
          "date": "30th July",
          "choices": [
            "白衣",
            {
              "comment": "Whichever you find the funniest"
            },
            "開けてみる",
            "年下でないと嫌だ",
            "まだ盗み聞きをする",
            [
              {
                "choice": "猫の鳴き真似をしてみる",
                "comment": "Non-H scene"
              },
              {
                "choice": "まだ聞き耳を立てる",
                "comment": "H scene"
              },
              {
                "choice": "No choice",
                "comment": "This choice is not present if you are using All ages patch"
              }
            ]
          ]
        },
        {
          "date": "2nd August",
          "choices": [
            "法術を使って錠前を外す"
          ]
        },
        {
          "date": "3rd August",
          "choices": [
            "乗らない",
            "これからも佳乃の側にいる",
            "神社",
            "バス停",
            {
              "end": "KANO END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Misuzu",
      "id": "dream-misuzu",
      "route": [
        {
          "choices": [
            {
              "load": "A"
            },
            "書き足してもらう",
            "観鈴を信じる",
            "リヤカーに乗る",
            "その通りだ"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "わかったよ",
            "胸を貸してやる",
            "とどめのひと突き",
            "観鈴を待っている",
            "神尾家へ",
            "ああ、そうする",
            "寝てしまう"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "敢えてステゴザウルスＴシャツを借りる",
            "敢えて着続けてみる",
            "俺のおごりだ",
            {
              "comment": "Whichever you find the funniest"
            },
            "商店街",
            "中に入る",
            "大人しく待つ",
            "観鈴の部屋にいく",
            "試してみる",
            "遊ぶ"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "ここにいる"
          ]
        },
        {
          "date": "27th July",
          "choices": [
            "…わかった"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "抱きしめる",
            [
              {
                "choice": "このままでいる",
                "comment": "Non-H scene"
              },
              {
                "choice": "体を求める",
                "comment": "H scene"
              },
              {
                "choice": "No choice",
                "comment": "This choice is not present if you are using All ages patch"
              }
            ],
            {
              "end": "MISUZU END"
            }
          ]
        }
      ]
    },
    {
      "name": "Summer",
      "id": "summer",
      "route": [
        {
          "choices": [
            {
              "comment": "Não há opções neste segmento."
            }
          ]
        }
      ]
    },
    {
      "name": "Air",
      "id": "air",
      "route": [
        {
          "date": "16th July",
          "choices": [
            "女の子を追う"
          ]
        },
        {
          "date": "17th July",
          "choices": [
            "戦う"
          ]
        },
        {
          "date": "19th July",
          "choices": [
            [
              {
                "choice": "みすずについてゆく &rarr; 中に入ってみる",
                "comment": "Kano scene"
              },
              {
                "choice": "男についてゆく",
                "comment": "Yukito scene"
              }
            ],
            "外にでる",
            "防御"
          ]
        },
        {
          "date": "20th July",
          "choices": [
            "散歩に出る",
			"せまい道に入ってみる",
			"戦う",
			"迂回する",
            "確かめにいく"
          ]
        },
        {
          "date": "21st July",
          "choices": [
            "男についてゆく",
            "紙切れを奪う"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "もう一度遠い日のことを考える"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "彼女のそばにいる",
            "真っ直ぐいく",
            {
              "end": "AIR END"
            }
          ]
        }
      ]
    }
  ],
  "Winter Confetti translation": [
    {
      "name": "Dream / Common (Bad End)",
      "id": "dream-common",
      "route": [
        {
          "date": "18th July",
          "choices": [
            "Think of another way",
            "Run away",
            "Tell her",
            "Run away",
            "Transfer it to the girl",
            [
              {
                "choice": "Let's find out!",
                "comment": "For the lulzy option"
              },
              {
                "choice": "Behave yourself",
                "comment": "For the plot option"
              }
            ],
			[
              {
                "choice": "Call the ramen shop again",
                "comment": "If you picked the first choice above"
              },
              {
                "choice": "Try calling her friends",
                "comment": "If you picked the second choice above"
              }
			],
            "Try resisting",
            "Be honest",
            "Drink",
            "Please do"
          ]
        },
        {
          "date": "19th July",
          "choices": [
            "Try again",
            "Go inside the school",
            "Pretend it's nothing",
            "Dining table",
            "Give her a straight answer",
            "Help her",
            "It's unbearably adorable",
            "Don't",
            "Listen",
            "How does she punish you?",
            [
              {
                "choice": "Ask about it",
                "comment": "Non-H scene"
              },
              {
                "choice": "Go to sleep",
                "comment": "H scene / This H Scene is not present if you are using All ages patch"
              }
            ]
          ]
        },
        {
          "date": "20th July",
          "choices": [
            "A skipping rope",
            "Head to the right side of the map",
            "Try calling out to it",
            "Give it something, anything!",
            "Ask about the bandana",
            "Sure",
            "Don't treat her",
            "Give it a go",
            "The Takeda Store",
            "Show them",
            "Probably",
            "Think about it",
            "Yeah, okay"
          ]
        },
        {
          "date": "21st July",
          "choices": [
            "I'll give it to Misuzu once I'm debt-free",
            "Show them my muscles",
            {
              "save": "A"
            },
            "No thanks",
            "Get on the bike",
            "Absolutely not"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "Play with your friends",
            "Counter-attack",
            "Send her flying!",
            "Had time to kill",
            "Let her see the puppet show",
            "Head to the school",
            "I don't exactly hate them",
            "Go out for a walk",
            "Go a little further",
            "Wait and see",
            "Try to explain it somehow"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "I'll go out of my way to borrow the Stegosaurus one",
            "Change into the wet t-shirt",
            "High street",
            "Inside the clinic",
            "Make use of this meaningless time",
            {
              "save": "B"
            },
            "Walk towards the embankment",
            "Head towards the bus stop",
            "Leave town",
            {
              "end": "BAD END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Minagi",
      "id": "dream-minagi",
      "route": [
        {
          "choices": [
            {
              "load": "B"
            },
            "Walk towards the station",
            "Pick it up and give it back",
            "Stick it in"
          ]
        },
        {
          "date": "24th July",
          "choices": [
            "Yum yum!",
            {
              "save": "C"
            },
            "There's a lunchbox waiting for me"
          ]
        },
        {
          "date": "25th July",
          "choices": [
            "Lend a hand",
            "Hand over the puppet",
            "It's too hot, so ask to go home",
            "Tell her to come up",
            "Don't bring up the bandana anymore"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "Go meet Misuzu"
          ]
        },
        {
          "date": "27th July",
          "choices": [
            "Obediently accept it"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "Letter S",
            "But the dictionary!",
            "I guess I'm a little jealous"
          ]
        },
        {
          "date": "7th August",
          "choices": [
            {
              "save": "D"
            },
			{
            "choice":"Ask for a good morning kiss",
			"comment": "H Scene / This H Scene is not present if you are using All ages patch"
			},
            {
              "end": "NORMAL END"
            },
            {
              "load": "D"
            },
            "She'll just have to wait until tomorrow",
            {
              "end": "MINAGI GOOD END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Kano",
      "id": "dream-kano",
      "route": [
        {
          "choices": [
            {
              "load": "C"
            },
            "Eat with them"
          ]
        },
        {
          "date": "25th July",
          "choices": [
            "Leave her alone",
            "Keep walking with her until the end",
            "Tease her a little more",
            "Don't bring up the bandana anymore"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "Go make money on the high street",
            "Search by yourself",
            "Practise your puppet show"
          ]
        },
        {
          "date": "28th July",
          "choices": [
            "Accept"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "Offer to go with Kano"
          ]
        },
        {
          "date": "30th July",
          "choices": [
            "Robe",
            {
              "comment": "Whichever you find the funniest"
            },
            "Open it",
            "They have to be younger than me",
            "Eavesdrop for a bit longer",
            [
              {
                "choice": "Meow",
                "comment": "Non-H scene"
              },
              {
                "choice": "Listen some more",
                "comment": "H scene"
              },
              {
                "choice": "No choice",
                "comment": "This choice is not present if you are using All ages patch"
              }
            ]
          ]
        },
        {
          "date": "2nd August",
          "choices": [
            "Pick the lock with Houjutsu"
          ]
        },
        {
          "date": "3rd August",
          "choices": [
            "Stay here",
            "I want to be with Kano",
            "Shrine",
            "Bus stop",
            {
              "end": "KANO END"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Misuzu",
      "id": "dream-misuzu",
      "route": [
        {
          "choices": [
            {
              "load": "A"
            },
            "Have her add stuff to it",
            "Believe in Misuzu",
            "Get on the cart",
            "Indeed we are"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "Fine, I'll play with you",
            "Let her practise",
            "Finish her!",
            "Am waiting for Misuzu",
            "Head to the Kamio house",
            "Yeah, I would",
            "Sleep"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "I'll go out of my way to borrow the Stegosaurus one",
            "Continue wearing it",
            "It'll be my treat",
            {
              "comment": "Whichever you find the funniest"
            },
            "High street",
            "Go inside",
            "Wait quietly",
            "Go to Misuzu's room",
            "Give it a try",
            "Play with Misuzu"
          ]
        },
        {
          "date": "26th July",
          "choices": [
            "Stay here"
          ]
        },
        {
          "date": "27th July",
          "choices": [
            "...I understand"
          ]
        },
        {
          "date": "29th July",
          "choices": [
            "Hug her",
            [
              {
                "choice": "Stay like this",
                "comment": "Non-H scene"
              },
              {
                "choice": "Make love to her",
                "comment": "H scene"
              },
              {
                "choice": "No choice",
                "comment": "This choice is not present if you are using All ages patch"
              }
            ],
            {
              "end": "MISUZU END"
            }
          ]
        }
      ]
    },
    {
      "name": "Summer",
      "id": "summer",
      "route": [
        {
          "choices": [
            {
              "comment": "Não há opções neste segmento."
            }
          ]
        }
      ]
    },
    {
      "name": "Air",
      "id": "air",
      "route": [
        {
          "date": "16th July",
          "choices": [
            "Follow the girl"
          ]
        },
        {
          "date": "17th July",
          "choices": [
            "Attack"
          ]
        },
        {
          "date": "19th July",
          "choices": [
            [
              {
                "choice": "Follow Misuzu &rarr; Try going inside",
                "comment": "Kano scene"
              },
              {
                "choice": "Follow the man",
                "comment": "Yukito scene"
              }
            ],
            "Go outside",
            "Defend"
          ]
        },
        {
          "date": "20th July",
          "choices": [
            "Go on a walk",
			"Try the small path",
			"Attack",
			"Move behind it",
            "Go have a look"
          ]
        },
        {
          "date": "21st July",
          "choices": [
            "Follow the man",
            "Snatch the paper!"
          ]
        },
        {
          "date": "22nd July",
          "choices": [
            "Try thinking about the past again"
          ]
        },
        {
          "date": "23rd July",
          "choices": [
            "Stay near her",
            "Straight ahead",
            {
              "end": "AIR END"
            }
          ]
        }
      ]
    }
  ],
  "Tradução Kikachan": [
    {
      "name": "Dream / Rota Comum (Final Ruim)",
      "id": "dream-common",
      "route": [
        {
          "date": "18 de Julho",
          "choices": [
            "Encontrar outra coisa",
            "Sair correndo",
            "Contar pra ela",
            "Fugir",
            "Transferir a dor de volta pra garota",
            [
              {
                "choice": "Pegar o telefone e fazer uma chamada",
                "comment": "Para a opção divertida"
              },
              {
                "choice": "Comportar-se",
                "comment": "Para a opção séria"
              }
            ],
			[
              {
                "choice": "Ligar pra loja de ramen novamente",
                "comment": "Se escolheu a primeira opção acima"
              },
              {
                "choice": "Ligar pros meus amigos",
                "comment": "Se escolheu a segunda opção acima"
              }
			],
            "Questionar",
            "Ser sincero com ela",
            "Eu posso beber",
            "Por favor, faça isso"
          ]
        },
        {
          "date": "19 de Julho",
          "choices": [
            "Tentar novamente",
            "Entrar na escola",
            "Agir com indiferença",
            "Na mesa de jantar",
            "Responder da melhor forma possível",
            "Ajudar ela",
            "”É super fofo”",
            "Não mostrar pra elas a apresentação",
            "Perguntar pra ela",
            "Que tipo de punição?",
            [
              {
                "choice": "Peça detalhes a ela",
                "comment": "Cena Não-H"
              },
              {
                "choice": "Tô cansado. Vou dormir",
                "comment": "Cena H / Essa cena não estará presente se você estiver usando o patch Para todas as idades"
              }
            ]
          ]
        },
        {
          "date": "20 de Julho",
          "choices": [
            "Corda de pular",
            "Vá para o local no lado direito do mapa",
            "Tentar falar com isso",
            "Fazer um favor, qualquer favor",
            "Perguntar sobre sua bandana",
            "Sim, me conte",
            "Não pagar um suco pra ela",
            "Pôr a ideia em prática",
            "Loja Takeda",
            "Fazer uma apresentação para o cachorro",
            "Provavelmente sim",
            "Vou pensar sobre isso",
            "Me apresente o trabalho"
          ]
        },
        {
          "date": "21 de Julho",
          "choices": [
            "Dar a preguiça pra Misuzu após comprar",
            "Mostrar pra ela sua força física",
            {
              "save": "A"
            },
            "Não, obrigado",
            "Subir na motocicleta",
            "Sem chance"
          ]
        },
        {
          "date": "22 de Julho",
          "choices": [
            "Vá brincar com seus amigos",
            "Partir para o contra-ataque",
            "Jogar ela pra fora do ringue",
            "Tô apenas matando o tempo",
            "Apresentar o show de marionetes pra ela",
            "Ir pra escola",
            "Eu não odeio elas",
            "Sair para uma caminhada",
            "Atravessar a ponte",
            "Conferir",
            "Tentar explicar a situação"
          ]
        },
        {
          "date": "23 de Julho",
          "choices": [
            "Vou vestir a camiseta com o estegossauro",
            "Trocar pela camiseta molhada",
            "Distrito comercial",
            "Dentro da clínica",
            "Tentar matar o tempo",
            {
              "save": "B"
            },
            "Caminhar em direção ao paredão",
            "Ir pro ponto de ônibus",
            "Deixar a cidade",
            {
              "end": "FINAL RUIM"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Minagi",
      "id": "dream-minagi",
      "route": [
        {
          "choices": [
            {
              "load": "B"
            },
            "Caminhar em direção à estação",
            "Pegar o canudinho e devolver pra ela",
            "Fazer isso"
          ]
        },
        {
          "date": "24 de Julho",
          "choices": [
            "Provar o osso",
            {
              "save": "C"
            },
            "Eu vou passar"
          ]
        },
        {
          "date": "25 de Julho",
          "choices": [
            "Ajudar a senhora",
            "Entregar o boneco",
            "Reclamar que tá muito quente pra passear",
            "Falar pra ela subir",
            "Parar de perguntar sobre a bandana"
          ]
        },
        {
          "date": "26 de Julho",
          "choices": [
            "Encontrar Misuzu"
          ]
        },
        {
          "date": "27 de Julho",
          "choices": [
            "Aceitar com gratidão"
          ]
        },
        {
          "date": "29 de Julho",
          "choices": [
            "Linha ”Ta”",
            "Continuar lendo o dicionário",
            "Agir com ciúmes"
          ]
        },
        {
          "date": "7 de Agosto",
          "choices": [
            {
              "save": "D"
            },
			{
            "choice":"Me dê um beijo de bom dia",
			"comment": "Cena H / Essa cena não estará presente se você estiver usando o patch Para todas as idades"
			},
            {
              "end": "FINAL NORMAL"
            },
            {
              "load": "D"
            },
            "Tente novamente amanhã",
            {
              "end": "FINAL BOM DA MINAGI"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Kano",
      "id": "dream-kano",
      "route": [
        {
          "choices": [
            {
              "load": "C"
            },
            "Comer antes de sair"
          ]
        },
        {
          "date": "25 de Julho",
          "choices": [
            "Ela que se vire",
            "Acompanhar ela até o fim",
            "Zoar ela mais um pouco",
            "Parar de perguntar sobre a bandana"
          ]
        },
        {
          "date": "27 de Julho",
          "choices": [
            "Ir para o distrito comercial",
            "Procurar por Kano",
            "Praticar meu show de marionete"
          ]
        },
        {
          "date": "28 de Julho",
          "choices": [
            "Aceitar"
          ]
        },
        {
          "date": "29 de Julho",
          "choices": [
            "Acompanhar Kano na busca por Potato"
          ]
        },
        {
          "date": "30 de Julho",
          "choices": [
            "Jaleco branco",
            {
              "comment": "O que você achar mais engraçado"
            },
            "Abrir o armário",
            "Elas têm que ser mais novas que eu",
            "Escutar mais um pouco",
            [
              {
                "choice": "Miar como um gato",
                
              },
              {
                "choice": "Continuar escutando",
                "comment": "Cena H / Essa cena não estará presente se você estiver usando o patch Para todas as idades"
              }
              ]
          ]
        },
        {
          "date": "2 de Agosto",
          "choices": [
            "Usar o Houjutsu para abrir a fechadura"
          ]
        },
        {
          "date": "3 de Agosto",
          "choices": [
            "Não entrar no ônibus",
            "Eu vou continuar com a Kano",
            "Santuário",
            "Ponto de ônibus",
            {
              "end": "FINAL DA KANO"
            }
          ]
        }
      ]
    },
    {
      "name": "Dream / Misuzu",
      "id": "dream-misuzu",
      "route": [
        {
          "choices": [
            {
              "load": "A"
            },
            "Permitir que ela melhore o mapa",
            "Ter fé no mapa de Misuzu",
            "Subir no carrinho de mão",
            {
              "comment": "Essa escolha não aparecerá se você não tiver aceitado a ajuda da Haruko para conseguir um emprego"}
              , 
            "Com certeza"
          ]
        },
        {
          "date": "22 de Julho",
          "choices": [
            "Tudo bem",
            "Deixar ela empurrar meu peito",
            "Dar o empurrão final",
            "Tô esperando a Misuzu",
            "Ir pra Residência Kamio",
            "Sim, claro que irei",
            "Ir dormir"
          ]
        },
        {
          "date": "23 de Julho",
          "choices": [
            "Vou vestir a camiseta com o estegossauro",
            "Continuar com a camiseta do estegossauro",
            "Pode deixar por minha conta",
            "Movido a energia solar",
            {
              "comment": "O que você achar mais engraçado"
            },
            "Distrito comercial",
            "Esperar Misuzu sair",
            "Esperar pacientemente",
            "Ir pro quarto de Misuzu",
            "Tentar",
            "Brincar com Misuzu"
          ]
        },
        {
          "date": "26 de Julho",
          "choices": [
            "Ficar aqui"
          ]
        },
        {
          "date": "27 de Julho",
          "choices": [
            "Eu entendo"
          ]
        },
        {
          "date": "29 de Julho",
          "choices": [
            "Abraçar ela",
            [
              {
                "choice": "Se acalmar",
                "comment": "Cena Não-H"
              },
              {
                "choice": "Desejar o corpo dela",
                "comment": "Cena H"
              },
              {
                "choice": "Sem escolha",
                "comment": "Estas escolhas não aparecerão se você estiver jogando com o patch Para todas as idades"
              }
            ],
            {
              "end": "FINAL DA MISUZU"
            }
          ]
        }
      ]
    },
    {
      "name": "Summer",
      "id": "summer",
      "route": [
        {
          "choices": [
            {
              "comment": "Não há escolhas neste arco."
            }
          ]
        }
      ]
    },
    {
      "name": "Air",
      "id": "air",
      "route": [
        {
          "date": "16 de Julho",
          "choices": [
            "Seguir a garota"
          ]
        },
        {
          "date": "17 de Julho",
          "choices": [
            "Lutar"
          ]
        },
        {
          "date": "19 de Julho",
          "choices": [
            [
              {
                "choice": "Seguir Misuzu &rarr; Entrar na escola",
                "comment": "Cena com Kano"
              },
              {
                "choice": "Seguir o homem",
                "comment": "Cena com Yukito"
              }
            ],
            "Sair do quarto",
            "Se defender"
          ]
        },
        {
          "date": "20 de Julho",
          "choices": [
            "Sair para caminhar",
			"Percorrer o caminho estreito",
			"Lutar",
			"Se esquivar",
            "Conferir"
          ]
        },
        {
          "date": "21 de Julho",
          "choices": [
            "Seguir o homem",
            "Pegar a folha"
          ]
        },
        {
          "date": "22 de Julho",
          "choices": [
            "Pensar novamente sobre o passado."
          ]
        },
        {
          "date": "23 de Julho",
          "choices": [
            "Ficar com a garota",
            "Caminhar em linha reta",
            {
              "end": "FINAL DE AIR"
            }
          ]
        }
      ]
    }
  ]
};

////////////////////////////////////////////////////////////////////////////////

const getValue = (property) => {
  return localStorage.getItem(property);
};

const setValue = (property, value) => {
  if (value) {
    localStorage.setItem(property, value);
  }
};

function createNavigationHtml(navId) {
  var html = '';
  var routes = data[getValue('tl')];

  for (var i = 0; i < routes.length; i++) {
    html += '<li><a data-rt=' + routes[i].id + ' id="' + routes[i].id + '">' + routes[i].name + '</a></li>';
  }

  $(navId).html(html);
}

function createTableHtml(tableId, routeId) {
  var routeIndex = 0;
  var routes = data[getValue('tl')];
  for (var i = 0; i < routes.length; i++) {
    if (routes[i].id === routeId) {
      routeIndex = i;
      break;
    }
  }

  var name = routes[routeIndex].name;
  var route = routes[routeIndex].route;

  var html = '';

  html += '<h3 align="center">' + getValue('tl') + " &ndash; " + name + '</h3>';
  html += '<table>';

  // Header
  html += '<thead>';
  html += '<tr>';
  html += '<th style="width: 25%"><span class="date">Data</span></th>';
  html += '<th style="width: 75%"><span class="route">Escolha</span></th>';
  html += '</tr>';
  html += '</thead>';

  // Body
  html += '<tbody>';
  for (var i = 0; i < route.length; i++) {
    var date = route[i].date;
    var choices = route[i].choices;
    for (var j = 0; j < choices.length; j++) {
      if (j == 0 && date) {
        html += '<tr class="first" id="' + getValue('rt') + "_" + i + "_" + j + '">';
        html += '<td><span class="date">' + date + '</td>';
      } else {
        html += '<tr id="' + getValue('rt') + "_" + i + "_" + j + '">';
        html += '<td/>';
      }
      html += '<td>' + getTableCellData(choices[j]) + '</td>';
      html += '</tr>';
    }
  }
  html += '</tbody>';

  html += '</table>';

  $(tableId).html(html);
  $('table tbody tr', tableId).first().addClass('next');
  
  if (document.getElementById(getValue('pr')) != null) {
    trackProgress(document.getElementById(getValue('pr')));
  }
  else {
    setValue('pr',null)
  }  
  
  setSpoilers();
}

function getTableCellData(object) {
  var html = '';

  // Array
  if (Array.isArray(object)) {
    for (var i = 0; i < object.length; i++) {
      if (html !== '') {
        html += '<br/>';
      }
      html += getTableCellData(object[i]);
    }

  // Object
  } else if (typeof object === 'object') {
    if (object.save) {
      html += '<span class="alert">(';
      html += 'Salvar o jogo: ' + object.save;
      html += ')</span>';
    } else if (object.load) {
      html += '<span class="alert">(';
      html += 'Carregar o jogo: ' + object.load;
      html += ')</span>';
    } else if (object.end) {
      html += '<span class="alert">(';
      html += object.end;
      html += ')</span>';
    } else {
      if (object.choice) {
        html += object.choice;
      }
      if (object.comment) {
        html += ' <span class="comment">(';
        html += object.comment;
        html += ')</span>';
      }
    }

  // String
  } else {
    html += object;
  }

  return html;
}

////////////////////////////////////////////////////////////////////////////////

function toggleSpoilers() {
  var next = $('#walkthrough-table tbody .next');
  if (getValue('sp') == 'true') {
    setValue('sp','false');
  } else {
	setValue('sp','true');
  }
  setSpoilers();
}

function setSpoilers() {
  var next = $('#walkthrough-table tbody .next');
  if (getValue('sp') == 'true') {
    next.nextAll().addClass('hidden');
  } else {
    next.siblings().removeClass('hidden');
  }
}



function trackProgress(element) {
  if ($(element).next().get(0) !== undefined ) {
	setValue('pr',element.id);
	  
	// Mark previous lines
	$(element).addClass('previous');
	$(element).prevAll().addClass('previous');
	$(element).nextAll().removeClass('previous');

	// Mark next line
	$(element).removeClass('next');
	$(element).siblings().removeClass('next');
	$(element).next().addClass('next');

	$(element).removeClass('hidden');
	$(element).siblings().removeClass('hidden');
	if (getValue('sp') == 'true') {
	  // Hide all future lines except the next one
	  $(element).nextAll().addClass('hidden');
	  $(element).next().removeClass('hidden');
	  // Make sure the next line is in view
	  $(element).next().get(0).scrollIntoView();
	}
  }
}

////////////////////////////////////////////////////////////////////////////////
// Event handlers

$(document).ready(function() {
  if (getValue('tl') == null) {
    setValue('tl','Original Japanese');
  }
  if (getValue('rt') == null) {
    setValue('rt','dream-common');	
  }
  if (getValue('sp') == null) {
    setValue('sp','true');	
  }
  else if (getValue('sp') == 'false') {
    $('#hide-spoilers').prop('checked',false)
  }
  
  createNavigationHtml('#walkthrough-nav');
  createTableHtml('#walkthrough-table', getValue('rt'));
});

// Route
$('body').on('click', '#walkthrough-nav li a', function() {
  setValue('rt',this.dataset.rt);
  createTableHtml('#walkthrough-table', getValue('rt'));
});

// Translation
$('body').on('click', '#tl a', function() {
  setValue('tl',this.dataset.tl);
  createTableHtml('#walkthrough-table', getValue('rt'));
});

$('body').on('click', '#options #hide-spoilers', function() {
  toggleSpoilers();
});

$('body').on('click', '#walkthrough-table tbody tr', function() {
  trackProgress(this);
});